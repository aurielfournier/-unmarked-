```{r}
# predictions from GDistsamp 2014 round 4
setwd("~/Documents/data")
library(unmarked)
#read in the sora observations
#read in the sora observations
sora <- read.csv('2014_sora.csv', header=T)
sora <- sora[!(sora$impound=="ccmsu12"|sora$impound=="ccmsu2"|sora$impound=="ccmsu1"|sora$impound=="ts2a"|sora$impound=="ts4a"|sora$impound=="ts6a"|sora$impound=="ts8a"|sora$impound=="kt2"|sora$impound=="kt5"|sora$impound=="kt5"|sora$impound=="kt6"|sora$impound=="kt9"|sora$impound=="pool2"|sora$impound=="pool2w"|sora$impound=="pool3w"|sora$impound=="m10"|sora$impound=="m11"|sora$impound=="m13"),]
#read in the covariate data #organized by impoundment.
cov <- read.csv('2014_cov_nostand.csv', header=T)
cov <- cov[!(cov$impound=="ccmsu12"|cov$impound=="ccmsu2"|cov$impound=="ccmsu1"|cov$impound=="ts2a"|cov$impound=="ts4a"|cov$impound=="ts6a"|cov$impound=="ts8a"|cov$impound=="kt2"|cov$impound=="kt5"|cov$impound=="kt5"|cov$impound=="kt6"|cov$impound=="kt9"|cov$impound=="pool2"|cov$impound=="pool2w"|cov$impound=="pool3w"|cov$impound=="m10"|cov$impound=="m11"|cov$impound=="m13"),]
#subset covaraites we need
cov <- cov[,c("region","length_4","impound","jdate_4","hectares","area", "treat","pe","int","short","averagewater_4")]
# #the distance bins

sora <- sora[order(sora$impound),]
cov <- cov[order(cov$impound),]

sora <- sora[,2:40]
cutpt = as.numeric(c(0,1,2,3,4,5,6,7,8,9,10,11,12,13)) 
#Unmarked Data Frame
umf14r4 = unmarkedFrameGDS(y=sora, 
                           numPrimary=3,
                           siteCovs = cov,
                           survey="line", 
                           dist.breaks=cutpt,  
                           unitsIn="m", 
                           tlength=cov$length_4,
)

```
```{r}
model14r4 <- list()
model14r4$null14r4 = gdistsamp(lambdaformula = ~1, 
                     phiformula = ~1, 
                     pformula = ~1,
                     data = umf14r4, keyfun = "hazard", mixture="P",se = T, output="abund")

model14r4$reg14r4 = gdistsamp(lambdaformula = ~region-1, 
                    phiformula = ~1, 
                    pformula = ~ 1,
                    data = umf14r4, keyfun = "hazard", mixture="P",se = T, output="abund")
```
```{r}


model14r4$reg_w14r4 =gdistsamp(lambdaformula = ~region+averagewater_4-1, 
                     phiformula = ~1, 
                     pformula = ~ 1,
                     data = umf14r4, keyfun = "hazard", mixture="P",se = T, output="abund")

model14r4$reg_w_i_14r4 =gdistsamp(lambdaformula = ~region+averagewater_4+region*averagewater_4-1, 
                     phiformula = ~1, 
                     pformula = ~ 1,
                     data = umf14r4, keyfun = "hazard", mixture="P",se = T, output="abund")
```
```{r}
model14r4$short_r14r4 =gdistsamp(lambdaformula = ~short+region-1, 
                     phiformula = ~1, 
                     pformula = ~ 1,
                     data = umf14r4, keyfun = "hazard", mixture="P",se = T, output="abund")
model14r4$short_r_i_14r4 =gdistsamp(lambdaformula = ~short+region+short*region-1, 
                     phiformula = ~1, 
                     pformula = ~ 1,
                     data = umf14r4, keyfun = "hazard", mixture="P",se = T, output="abund")


```{r}
model14r4$short14r4 =gdistsamp(lambdaformula = ~short-1, 
                     phiformula = ~1, 
                     pformula = ~ 1,
                     data = umf14r4, keyfun = "hazard", mixture="P",se = T, output="abund")

model14r4$short_w14r4 =gdistsamp(lambdaformula = ~short+averagewater_4-1, 
                       phiformula = ~1, 
                       pformula = ~ 1,
                       data = umf14r4, keyfun = "hazard", mixture="P",se = T, output="abund")
model14r4$short_w_i_14r4 =gdistsamp(lambdaformula = ~short+averagewater_4+short*averagewater_4-1, 
                       phiformula = ~1, 
                       pformula = ~ 1,
                       data = umf14r4, keyfun = "hazard", mixture="P",se = T, output="abund")
```
```{r}
model14r4$global14r4=gdistsamp(lambdaformula = ~region+averagewater_4+short+region*averagewater_4+region*short-1, phiformula = ~1, 
                      pformula = ~ 1,
                      data = umf14r4, keyfun = "hazard", mixture="P",se = T, output="abund")

```
```{r}
list14r4  = fitList(fits=model14r4)
(models14r4 = modSel(list14r4))

```